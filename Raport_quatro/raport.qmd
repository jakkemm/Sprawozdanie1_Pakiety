---
title: "Analiza wyników w trójboju"
author: "Emil Olszewski, Jakub Kempa"
date: 2024-01-17
format: 
  html:
    page-layout: full
    grid:
      sidebar-width: 100px
      margin-width: 100px
      body-width: 1200px
knitr:
  opts_chunk:
    fig.align: center
editor: visual
---

# 1. Wstęp

Przedmiotem analizy są dane ze zbioru zawierającego informacje na temat trójboistów zrzeszonch w ramach federacji IPF. [Dane](https://gitlab.com/openpowerlifting/opl-data) zostały udostępnione na warunkach licencji **GNU AGPLv3.** Głównymi zmiennymi, które będą nas interesować są **AgeClass, Sex** (zmienne kategoryczne określające przedział wiekowy zawodnika oraz jego płeć) oraz zmienne ciągłe **BodyweightKg, TotalKg,** które wyrażają masę ciała zawodnika, oraz wynik całkowity będący sumą wyników w poszczególnych bojach (*przysiad ze stangą, wyciskanie na ławce* oraz *martwy ciąg)*.

## 1.1 Opis zmiennych 

-   **AgeClass (Wiek)-** zmienna kateogryczna reprezentująca przedziały wiekowe według, których klasyfikowani są zawodnicy. Przyjmuje wartość najmniejszą **5-12** oraz największą **80+**

-   **Sex (Płeć)-** zmienna kategoryczna określająca płeć zawodnika.

-   **BodyweightKg (Masa)-** zmienna reprezentująca masę ciała zawodnika w kilogramach. Masa ciała jest istotnym parametrem w trójboju siłowym, ponieważ klasyfikuje zawodników w odpowiednie kategorie wagowe i może wpływać na ich wydajność w zawodach.

-   **TotalKg (Wynik) -** zmienna ta odnosi się do sumy maksymalnych ciężarów, które zawodnik podniósł w trzech bojach: *przysiadzie ze sztangą, wyciskaniu na ławce leżąc oraz martwym ciągu.* Jest to główny wskaźnik wydajności w trójboju siłowym, odzwierciedlający siłe i umiejętności zawodnika. W dalszej części raportu będdziemy używać określeń takich jak **Wynik sumaryczny, całkowity, total.**

## 1.2 Pytania badawcze

W ramach analizy postaramy się odpowiedzieć na następujące pytania:

1.  Czy istnieje zależność między wagą a wynikiem całkowitym?

2.  Jakie parametry opisują rozkłady poszczególnych zmiennych?

3.  W jaki sposób różnią się rozkłady wyniku oraz wagi w zależności od wieku i płci?

# 2. Ładowanie danych

Wpierw przystąpimy do załadowania potrzebnych bibliotek

```{r}
#| warning: false
library(tidyverse)
```

Teraz odczytamy dane z pliku csv.

```{r}
probka <- read.csv("../powerlifting.csv")
```

Będziemy poddawać analizie próbkę o długości 49 999 obserwacji.

```{r}
nrow(probka)
```

Tak się prezentuje 10 początkowych obserwacji

```{r}
head(probka)
```

## 2.1 Transformacje danych

Interesować nas będą tylko zmienne **AgeClass, Sex, BodyweightKg, TotalKg**

```{r}

probka <- probka[, c("AgeClass", "Sex", "BodyweightKg", "TotalKg")]

summary(probka)
```

Napotykamy pierwszy problem. Typy niektórych zmiennych są nieodpowiednie. Prawidłowe typy to

-   `numeric` dla **BodyweightKg, TotalKg**

-   `factor` dla **AgeClass** oraz **Sex**

Dokonajmy więc konwersji

```{r}
probka$BodyweightKg <- as.numeric(probka$BodyweightKg)
probka$TotalKg      <- as.numeric(probka$TotalKg)

probka$AgeClass     <- as.factor(probka$AgeClass)
probka$Sex          <- as.factor(probka$Sex)
```

```{r}
summary(probka)
```

Dokonamy teraz zmiany nazw kolumn na bardziej przystępne

```{r}
colnames(probka) <- c("wiek", "plec", "masa", "total")
head(probka)
```

Na sam koniec posortujemy jeszcze kolumnę wiek w kolejności rosnącej

# 3. Histogramy

```{r}
#| code-fold: true
#| warning: false
#| layout-ncol: 2

# Plot normalized histograms for each level of the "wiek" factor

desired_order = c("5-12", "13-15", "16-17", "18-19", "20-23", "24-34", "35-39", "40-44", "45-49", "50-54", "55-59", "60-64", "65-69", "70-74", "75-79", "80-999")


ggplot(probka, aes(x = wiek, y = ..count.., fill = ..count..)) +
  geom_bar(color = "black", alpha = 0.7, position = "identity") +
  labs(title = "Histogram - Wiek", x = "wiek", y = "ilość") +
  scale_x_discrete(limits = desired_order) + 
  theme_minimal()

ggplot(probka, aes(x = plec, y = ..count.., fill = ..count..)) +
  geom_bar(color = "black", alpha = 0.7, position = "identity") +
  ggtitle("Histogram - Wiek") + 
  theme_minimal()

ggplot(probka, aes(x = masa, y = ..density.., fill = ..density..)) +
  geom_histogram(binwidth = 7, color = "black", alpha = 0.7, position = "identity") +
  ggtitle("Histogram - Masa") +
  theme_minimal() +
  scale_y_continuous(labels = scales::percent_format(scale = 1))

ggplot(probka, aes(x = total, y = ..density.., fill = ..density..)) +
  geom_histogram(binwidth = 20, color = "black", alpha = 0.7, position = "identity") +
  ggtitle("Histogram - Total") +
  theme_minimal() +
  scale_y_continuous(labels = scales::percent_format(scale = 1))

```

## 3.1. Rozkłady warunkowe 

### 3.1.1. Rozkłady zmiennych warunkowane płcią

Na wykresach poniżej znajdują się rozkłady zmiennych **Masa** oraz **Total** warunkowane zmienną **Płeć.** Z wykresów możemy zauważyć ewidentną **bimodalność** zmiennej **Total** dla określonej płci.

```{r}
#| code-fold: true
#| warning: false
#| layout-ncol: 2
ggplot(probka, aes(x = masa, y = ..density.., fill = ..density..)) +
  geom_histogram(binwidth = 7, color = "black", alpha = 0.7, position = "identity") +
  ggtitle("Histogram - Masa") +
  theme_minimal() +
  facet_grid(plec ~ ., scales = "free_y") +
  scale_y_continuous(labels = scales::percent_format(scale = 1))

ggplot(probka, aes(x = total, y = ..density.., fill = ..density..)) +
  geom_histogram(binwidth = 20, color = "black", alpha = 0.7, position = "identity") +
  ggtitle("Histogram - Total") +
  theme_minimal() +
  facet_grid(plec ~ ., scales = "free_y") +
  scale_y_continuous(labels = scales::percent_format(scale = 1))
```

Na poniższych wykresach pudełkowych przedstawione są rozkłady zmiennych **Masa** i **Total** warunkowane zmienną **Wiek.**

### 3.1.2. Rozkłady zmiennych warunkowane wiekiem.

#### 3.1.2.1. Wynik total a wiek.

Przypatrując się rozkładom zmiennej **Total** widzimy, że górne wąsy są znacznie dłuższe od dolnych oraz, że mediana jest bliżej pierwszego kwartyla. Dodatkowo różnice te zdają się narastać z wiekiem. Możemy zatem wywnioskować znaczną prawostronną skośność zmiennej **Total** warunkowanej **Wiekiem.** Dodatkowo skośność ta zwiększa się wraz ze wzrostem wieku.

#### 3.1.2.2. Masa a wiek.

Patrząc zaś na boxploty opisujące **masę** zawodnika widzimy wiele wartości skrajnych większych niż $Q_3 + 1,5\,\text{IQR}$ co jest przesłanką ku leptokurtyczności rozkładów warunkowych. Zjawisko to ma prostą interpretację. Otóż we wszystkich zawodach trójbojowych stosuje się **kategorie wagowe** aby zwodnicy konkurowali z rywalami do siebie podobnymi**.** Ostatnią kategorią są zazwykle kategorie typu 120+, 140+, które nie posiadają kresu górnego. Tym samym u tych zawodników optymalne jest posiadanie jak największej masy ciała aby zyskać przewagę nad rywalami. Powoduje to częste występowanie wartości skrajnych. Z wykresu widzimy, że intensywność obserwacji wartości skrajnych jest największa u młodszych zawodników, mniej więcej do 35-tego roku życia. To również ma oczywistą interpretację. Zawodnikom młodszym łatwiej jest niż starszym nabrać duże ilości masy ciała jednocześnie zachowując odpowiednią atletyczność celem uzyskiwania jak najlepszych wyników.

```{r}
#| code-fold: true
#| warning: false
#| layout-ncol: 2
ggplot(probka, aes(x = wiek, y = masa, fill = wiek)) +
  geom_boxplot() +
  ggtitle("Wykresy pudełkowe masy warunkowanej wiekiem") +
  scale_x_discrete(limits = desired_order) + 
  theme_minimal()

ggplot(probka, aes(x = wiek, y = total, fill = wiek)) +
  geom_boxplot() +
  ggtitle("Wykresy pudełkowe wyniku total warunkowanego wiekiem") +
  scale_x_discrete(limits = desired_order) + 
  theme_minimal()
```

# 4. Analiza zależności

## 4.1 Zależność pomiędzy masą a wynikiem total.

```{r}
#| code-fold: true
#| warning: false

ggplot(probka, aes(x = masa, y = total, color = plec)) +
  geom_point(size = 1) +
  labs(title = "Wykres rozproszenia ",
       x = "masa", y = "total", color = "płeć") +
  theme_minimal()
```

Celem lepszej analizy zależności dokonamy teraz uśrednienia zmiennej **Total** po zawodnikach tej samej płci o tej samej masie.

```{r}
#| code-fold: true 
#| warning: false
probka_mean <- probka %>%
  group_by(masa, plec) %>%
  mutate(mean_total = mean(total))

# Keep only unique values of "masa"
probka_mean_unique <- probka_mean %>%
  distinct(masa, .keep_all = TRUE)

# Scatter plot with color by "plec" and mean points
ggplot(probka_mean_unique, aes(x = masa, y = mean_total, color = plec)) +
  geom_point(size = 3) +
  labs(title = "Scatter Plot of masa vs mean_total",
       x = "masa", y = "mean_total", color = "Gender") +
  theme_minimal()
```

Współczynniki korelacji pearsona dla całej populacji oraz dla każdej płci z osobna prezentują się następująco.

```{r}
#| code-fold: true 
cor_by_plec <- probka_mean_unique %>%
  group_by(plec) %>%
  summarize(correlation = cor(masa, total, use = "complete.obs"))

# Calculate correlation for the entire data frame
cor_total <- cor(probka_mean_unique$masa, probka_mean_unique$total, use = "complete.obs")

# Print the results
cat("Korelacja pomiędzy masą a wynikiem dla każdej z płci:\n")
print(cor_by_plec)

cat("Korelacja pomiędzy masą a wynikiem dla całej próbki:\n")
print(cor_total)
```
